<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>3. Add database | Nitro workshop</title>
    <meta name="description" content="">
    <link rel="icon" href="nitro-workshopnitro.png">
  <meta name="theme-color" content="#0078d7">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="msapplication-TileColor" content="#0078d7">
    <meta property="og:image" content="https://nitro-stack.github.io/nitro-workshop//nitro.jpg"><meta name="twitter:image" content="https://nitro-stack.github.io/nitro-workshop//nitro.jpg"><meta property="og:url" content="https://nitro-stack.github.io/nitro-workshop//step3.html"><meta name="twitter:url" content="https://nitro-stack.github.io/nitro-workshop//step3.html"><meta property="og:title" content="3. Add database"><meta name="twitter:title" content="3. Add database"><meta itemprop="name" content="3. Add database"><meta property="og:type" content="article"><meta name="twitter:card" content="summary"><meta property="og:site_name" content="Nitro Workshop - Learn how to make Node.js serverless REST APIs with NestJS and Azure">
    <link rel="preload" href="nitro-workshop/assets/css/0.styles.43be2a01.css" as="style"><link rel="preload" href="nitro-workshop/assets/js/app.99decfcb.js" as="script"><link rel="preload" href="nitro-workshop/assets/js/3.fd42e370.js" as="script"><link rel="preload" href="nitro-workshop/assets/js/2.89622c55.js" as="script"><link rel="preload" href="nitro-workshop/assets/js/13.aa04527c.js" as="script"><link rel="preload" href="nitro-workshop/assets/js/5.3a590768.js" as="script"><link rel="prefetch" href="nitro-workshop/assets/js/10.2ef16811.js"><link rel="prefetch" href="nitro-workshop/assets/js/11.34a9602d.js"><link rel="prefetch" href="nitro-workshop/assets/js/12.8f8bfd71.js"><link rel="prefetch" href="nitro-workshop/assets/js/14.3586d5c3.js"><link rel="prefetch" href="nitro-workshop/assets/js/15.f18ae210.js"><link rel="prefetch" href="nitro-workshop/assets/js/16.8be28db5.js"><link rel="prefetch" href="nitro-workshop/assets/js/4.1c62fd6e.js"><link rel="prefetch" href="nitro-workshop/assets/js/6.1a44795e.js"><link rel="prefetch" href="nitro-workshop/assets/js/7.5f4ec513.js"><link rel="prefetch" href="nitro-workshop/assets/js/8.b9599034.js"><link rel="prefetch" href="nitro-workshop/assets/js/9.2c440a67.js">
    <link rel="stylesheet" href="nitro-workshop/assets/css/0.styles.43be2a01.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/nitro-workshop/" class="home-link router-link-active"><img src="nitro-workshopnitro.png" alt="Nitro workshop" class="logo"> <span class="site-name can-hide">Nitro workshop</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/nitro-workshop/" class="nav-link">Home</a></div><div class="nav-item"><a href="/nitro-workshop/intro.html" class="nav-link">Workshop</a></div><div class="nav-item"><a href="https://nitr.ooo" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Nitro website
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/nitro-workshop/" class="nav-link">Home</a></div><div class="nav-item"><a href="/nitro-workshop/intro.html" class="nav-link">Workshop</a></div><div class="nav-item"><a href="https://nitr.ooo" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Nitro website
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/nitro-workshop/intro.html" class="sidebar-link">Introduction</a></li><li><a href="/nitro-workshop/env.html" class="sidebar-link">0. Prerequisites</a></li><li><a href="/nitro-workshop/step1/" class="sidebar-link">1. Bootstrap project</a></li><li><a href="/nitro-workshop/step2/" class="sidebar-link">2. Deploy application</a></li><li><a href="/nitro-workshop/step3/" class="active sidebar-link">3. Add database</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/nitro-workshop/step3/#configure-table-storage" class="sidebar-link">Configure Table Storage</a></li><li class="sidebar-sub-header"><a href="/nitro-workshop/step3/#integrate-with-nestjs" class="sidebar-link">Integrate with NestJS</a></li><li class="sidebar-sub-header"><a href="/nitro-workshop/step3/#create-an-entity" class="sidebar-link">Create an entity</a></li><li class="sidebar-sub-header"><a href="/nitro-workshop/step3/#inject-the-service" class="sidebar-link">Inject the service</a></li><li class="sidebar-sub-header"><a href="/nitro-workshop/step3/#add-new-endpoints" class="sidebar-link">Add new endpoints</a></li><li class="sidebar-sub-header"><a href="/nitro-workshop/step3/#testing-your-endpoints" class="sidebar-link">Testing your endpoints</a></li></ul></li><li><a href="/nitro-workshop/conclusion.html" class="sidebar-link">Conclusion</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_3-add-database"><a href="#_3-add-database" class="header-anchor">#</a> 3. Add database</h1> <p>Now that we have everything set up for our application code and deployment, we can go on with the more serious stuff and add a database instead of using hardcoded data.</p> <h2 id="configure-table-storage"><a href="#configure-table-storage" class="header-anchor">#</a> Configure Table Storage</h2> <p><a href="https://docs.microsoft.com/en-us/azure/storage/tables/table-storage-overview" target="_blank" rel="noopener noreferrer">Table Storage<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> is a simple NoSQL key/value data store that will allow you to save and retrieve data.</p> <p>You already created a storage account in the previous step, so you now have to generate an access token to allow our application to manipulate data in it:</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># Get the storage account connection string</span>
<span class="token comment"># Use here the storage account name you set in the previous step</span>
az storage account show-connection-string --name <span class="token operator">&lt;</span>your_storage_account_name<span class="token operator">&gt;</span>

<span class="token comment"># Generate the SAS key</span>
<span class="token comment"># It will be valid until the defined expiry date</span>
az storage account generate-sas --account-name <span class="token operator">&lt;</span>your_storage_account_name<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
                                --services btf <span class="token punctuation">\</span>
                                --resource-types sco <span class="token punctuation">\</span>
                                --permissions acdlrw --expiry <span class="token number">2020</span>-12-31
</code></pre></div><p>Now edit the file <code>local.settings.json</code>, and add these properties to the <code>Values</code> list:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;AZURE_STORAGE_ACCOUNT&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&lt;your storage account name&gt;&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;AZURE_STORAGE_CONNECTION_STRING&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&lt;your storage account connection string&gt;&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;AZURE_STORAGE_SAS_KEY&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&lt;your SAS key&gt;&quot;</span>
</code></pre></div><p>These values will be exposed to our app as <strong>environment variables</strong> by the Functions runtime, to allow access to your Azure storage.</p> <h2 id="integrate-with-nestjs"><a href="#integrate-with-nestjs" class="header-anchor">#</a> Integrate with NestJS</h2> <p>You are now ready to integrate the database with your NestJS application. First you have to install the <code>@nestjs/azure-database</code> package with this command:</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> <span class="token function">install</span> @nestjs/azure-database
</code></pre></div><p>Open the file <code>src/app.module.ts</code>, and add the <code>AzureTableStorageModule</code> to the modules imports:</p> <div class="language-ts extra-class"><pre class="language-ts"><code>@<span class="token function">Module</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  imports<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    AzureTableStorageModule<span class="token punctuation">.</span><span class="token function">forFeature</span><span class="token punctuation">(</span>Story<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      table<span class="token punctuation">:</span> <span class="token string">'stories'</span><span class="token punctuation">,</span>
      createTableIfNotExists<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token operator">...</span>
  <span class="token punctuation">]</span>
</code></pre></div><p>Don't forget to add the missing imports at the top:</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> AzureTableStorageModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/azure-database'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Story <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./stories/story.entity'</span><span class="token punctuation">;</span>
</code></pre></div><p>But hey, we don't have a <code>Story</code> entity yet? That's right, let's create it!</p> <h2 id="create-an-entity"><a href="#create-an-entity" class="header-anchor">#</a> Create an entity</h2> <p>A database entity is used to model the properties of whatever object you would like to store. In our case, we would like to store fun pets stories, so let's create define a <code>Story</code> entity.</p> <p>Create a new file <code>stories/story.entity.ts</code> with this code:</p> <div class="language-ts extra-class"><pre class="language-ts"><code>@<span class="token function">EntityPartitionKey</span><span class="token punctuation">(</span><span class="token string">'stories'</span><span class="token punctuation">)</span>
@<span class="token function">EntityRowKey</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Story</span> <span class="token punctuation">{</span>
  @<span class="token function">EntityString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> animal<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  @<span class="token function">EntityString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> description<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  @<span class="token function">EntityString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> imageUrl<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  @<span class="token function">EntityDateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> createdAt<span class="token punctuation">:</span> Date<span class="token punctuation">;</span>

  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token parameter">story<span class="token operator">?</span><span class="token punctuation">:</span> Partial<span class="token operator">&lt;</span>Story<span class="token operator">&gt;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> story<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Now let's break down the annotations we have used:</p> <ul><li><code>@EntityPartitionKey</code> defines the table storage <a href="https://docs.microsoft.com/en-us/rest/api/storageservices/understanding-the-table-service-data-model#partitionkey-property" target="_blank" rel="noopener noreferrer"><code>PartitionKey</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> which can be used to for load balancing across storage nodes.</li> <li><code>@EntityRowKey</code> is the unique identifier of an entity with a given partition.</li> <li>The entity types annotations such as <code>@EntityString</code> represent the data type of each property.
You can find here the complete list of <a href="https://docs.microsoft.com/fr-fr/dotnet/framework/data/adonet/entity-data-model-primitive-data-types" target="_blank" rel="noopener noreferrer">Entity Data Model types<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="inject-the-service"><a href="#inject-the-service" class="header-anchor">#</a> Inject the service</h2> <p>The next step is to inject the service that provides methods to perform CRUD operations on entities. The <code>@nestjs/azure-database</code> package gives you just that, using the annotation <code>@InjectRepository</code>.</p> <p>Open the file <code>src/stories/stories.controller.ts</code> and add this constructor:</p> <div class="language-ts extra-class"><pre class="language-ts"><code>@<span class="token function">Controller</span><span class="token punctuation">(</span><span class="token string">'stories'</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">StoriesController</span> <span class="token punctuation">{</span>
  <span class="token keyword">constructor</span><span class="token punctuation">(</span>
    <span class="token parameter">@<span class="token function">InjectRepository</span><span class="token punctuation">(</span>Story<span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> storiesRepository<span class="token punctuation">:</span> Repository<span class="token operator">&lt;</span>Story<span class="token operator">&gt;</span><span class="token punctuation">,</span></span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Don't forget to add these missing imports at the top of the file:</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> InjectRepository<span class="token punctuation">,</span> Repository <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/azure-database'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Story <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./story.entity'</span><span class="token punctuation">;</span>
</code></pre></div><p>You can now use <code>this.storiesRepositoy</code> within your controller to perform <a href="https://github.com/nestjs/azure-database#crud-operations" target="_blank" rel="noopener noreferrer">CRUD operations<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>:</p> <ul><li><code>create(entity: T, rowKeyValue?: string): Promise&lt;T&gt;</code>: creates a new entity (if rowKeyValue is null, a UUID will be generated).</li> <li><code>find(rowKey: string, entity: Partial&lt;T&gt;): Promise&lt;T&gt;</code>: finds one entity using its RowKey.</li> <li><code>findAll(tableQuery?: azure.TableQuery, currentToken?: azure.TableService.TableContinuationToken): Promise&lt;AzureTableStorageResultList&lt;T&gt;&gt;</code>: finds all entities that match the given query (return all entities if no query provided).</li> <li><code>update(rowKey: string, entity: Partial&lt;T&gt;): Promise&lt;T&gt;</code>: Updates an entity. It does a partial update.</li> <li><code>delete(rowKey: string, entity: T): Promise&lt;AzureTableStorageResponse&gt;</code>: Removes an entity from the database.</li></ul> <h2 id="add-new-endpoints"><a href="#add-new-endpoints" class="header-anchor">#</a> Add new endpoints</h2> <p>Now you have everything needed to create new endpoints to create and get stories:</p> <div class="language- extra-class"><pre class="language-text"><code>GET /stories/:id  // Get the story with the specified ID
GET /stories      // Get all stories
POST /stories     // Create a new story
</code></pre></div><p>Let's start with the first one, to retrieve a single story using its ID.
Add this method to your controller:</p> <div class="language-ts extra-class"><pre class="language-ts"><code>  @<span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">':id'</span><span class="token punctuation">)</span>
  <span class="token keyword">async</span> <span class="token function">getStory</span><span class="token punctuation">(</span>@<span class="token function">Param</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span> id<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>Story<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>storiesRepository<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Story</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Entity not found</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NotFoundException</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>We use the <code>@Get()</code> annotation like in <a href="/nitro-workshop/step1.html#Add-your-first-endpoint">Step 1</a>, but this time specified a <a href="https://docs.nestjs.com/controllers#route-parameters" target="_blank" rel="noopener noreferrer">route parameter<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> using <code>:id</code>.
This parameter can then be retrieved with the function arguments using the <code>@Param('id')</code> annotation.</p> <p>Then we call the <code>storiesRepository.find()</code> method to find the matching entity. In case it's not found, we catch the error and return a status <code>404</code> error using NestJS  predefined exception class <code>NotFoundException</code>.</p> <p>After that, it's time for you to work a bit by yourself to add the 2 remaining endpoints 😉.</p> <div class="custom-block tip"><p class="custom-block-title">Note</p> <p>For the create endpoint, if the property <code>createdAt</code> is not set, it should be added with the current date.</p></div> <p>If you're stuck, you may find some help in the <a href="https://docs.nestjs.com/controllers#full-resource-sample" target="_blank" rel="noopener noreferrer">NestJS documentation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> and <a href="https://github.com/nestjs/azure-database#crud-operations" target="_blank" rel="noopener noreferrer">@nestjs/azure-database documentation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <h2 id="testing-your-endpoints"><a href="#testing-your-endpoints" class="header-anchor">#</a> Testing your endpoints</h2> <p>After you finished adding the new endpoints, start your server using the functions emulator:</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> run start:azure
</code></pre></div><p>After the server is started, you can test if your new endpoints behave correctly using <code>curl</code>:</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">curl</span> http://localhost:7071/api/stories
<span class="token comment"># should return an empty list: []</span>

<span class="token function">curl</span> http://localhost:7071/api/stories/0
<span class="token comment"># should return 404 with an error</span>

<span class="token function">curl</span> http://localhost:7071/api/stories -X POST -H <span class="token string">&quot;content-type: application/json&quot;</span> -d<span class="token string">'{ &quot;animal&quot;: &quot;cat&quot;, &quot;description&quot;: &quot;Cats have supersonic hearing&quot; }'</span>
<span class="token comment"># should return the newly created story</span>

<span class="token function">curl</span> http://localhost:7071/api/stories
<span class="token comment"># should return a list with the previously added story</span>

<span class="token function">curl</span> http://localhost:7071/api/stories/<span class="token operator">&lt;</span>RowKey_from_post_command<span class="token operator">&gt;</span>
<span class="token comment"># should return this single story</span>
</code></pre></div><p>TODO:
6. Go to web storage explorer, import pre-made data to populate the DB
8. Develop+Test with frontend</p> <h1 id="redeploy"><a href="#redeploy" class="header-anchor">#</a> Redeploy</h1> <p>Now that everything works locally, let's deploy your latest changes:</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># Build your app</span>
<span class="token function">npm</span> run build

<span class="token comment"># Create an archive from your local files and publish it</span>
<span class="token comment"># Don't forget to change the name with the one you used previously</span>
func azure functionapp publish funpets-api
</code></pre></div><p>Then invoke one of the newer API to check that deployment went fine:</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">curl</span> https://<span class="token operator">&lt;</span>your-funpets-api<span class="token operator">&gt;</span>.azurewebsites.net/api/stories
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/nitro-workshop/step2/" class="prev">2. Deploy application</a></span> <span class="next"><a href="/nitro-workshop/conclusion.html">Conclusion</a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="nitro-workshop/assets/js/app.99decfcb.js" defer></script><script src="nitro-workshop/assets/js/3.fd42e370.js" defer></script><script src="nitro-workshop/assets/js/2.89622c55.js" defer></script><script src="nitro-workshop/assets/js/13.aa04527c.js" defer></script><script src="nitro-workshop/assets/js/5.3a590768.js" defer></script>
  </body>
</html>
